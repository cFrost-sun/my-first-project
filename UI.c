/*--------------------------------------------------------------------------
UI.C

Code file for generic 80C51 and 80C31 microcontroller.
Copyright (c) cFrost.
All rights reserved.
--------------------------------------------------------------------------*/
#include"UI.h"

UCHAR_8 code start[] =// 数据表
{
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x03,0x00,
      0x1C,0x00,0x00,0x00,0x00,0x03,0x81,0xE0,0x60,0x00,0x38,0x00,0xFF,0x87,0x07,0x80,
      0x1C,0xFF,0xF8,0xFF,0xFF,0x83,0x81,0xE0,0xF7,0xFB,0xBB,0xFF,0x80,0x0E,0x03,0xC0,
      0x1C,0xE0,0x38,0x01,0xC0,0x03,0x83,0xF0,0x36,0x1B,0xB8,0x07,0x80,0x1E,0xFF,0xFE,
      0x5D,0xE7,0x3B,0xFF,0xFF,0xE3,0x87,0xF8,0x16,0x1B,0xB8,0x0E,0x0E,0x1C,0x0F,0x00,
      0x7F,0xE7,0x3B,0xC1,0xC0,0xFF,0xFF,0x3C,0x06,0xDB,0xB8,0x3C,0x1E,0x3D,0xDE,0x70,
      0x7F,0xE7,0x3B,0xFF,0xFF,0xE7,0x9E,0x1E,0xC6,0xDB,0xB8,0x70,0x3C,0x7B,0xDC,0x70,
      0x7F,0xFF,0xFB,0xC1,0xC0,0xE7,0xBC,0x0F,0xE6,0xDB,0xB8,0xFF,0xF0,0x3F,0xB8,0x78,
      0x3E,0xE7,0x38,0x7F,0xFF,0x07,0xBF,0xFF,0xF6,0xDB,0xB9,0xF3,0xC0,0x0F,0x70,0x3C,
      0x1C,0xE7,0x38,0x1C,0x00,0x07,0xC0,0x00,0x36,0xDB,0xB8,0x07,0x98,0x0E,0xFF,0xFE,
      0x1C,0xEF,0xB8,0x7F,0xFF,0x8F,0xE3,0xDE,0x06,0xDB,0xB8,0x1E,0x3E,0x1E,0x1D,0xCE,
      0x1C,0xEF,0xB8,0xFC,0x0F,0x0F,0xFD,0xDC,0x06,0xDB,0xB8,0x38,0x0F,0x1C,0x1D,0xC0,
      0x1C,0xEF,0xFB,0xCF,0xFC,0x1F,0x9D,0xDC,0x36,0xDB,0xB8,0xFF,0xFF,0xFF,0x9D,0xC0,
      0x1E,0xFF,0xF8,0x1F,0xF8,0x1F,0x9D,0xDC,0x36,0xDB,0xB9,0xC3,0xC1,0xFC,0x1D,0xC0,
      0x1F,0xFC,0xFB,0xF0,0x0F,0xFB,0x9D,0xF8,0x30,0xC3,0xB8,0x33,0xF8,0x00,0x1D,0xCE,
      0x3F,0xF8,0xF8,0x03,0x80,0x03,0x8E,0xF8,0x71,0xE0,0x38,0xF3,0xFE,0x0F,0xDD,0xCE,
      0x3B,0xF8,0x38,0xFF,0xFF,0x83,0x8E,0x38,0x73,0xF0,0x39,0xE3,0xCF,0x7C,0x39,0xCE,
      0x73,0xE0,0x38,0x07,0x03,0x83,0x80,0x70,0x77,0xB8,0x3B,0x83,0xC3,0x80,0x71,0xEE,
      0x70,0xFF,0xF8,0x0E,0x03,0x83,0xFF,0xFF,0xEF,0x1C,0x7F,0x1F,0x81,0xC0,0xE0,0xFC,
      0x60,0xE0,0x38,0x3C,0x07,0x03,0x80,0x00,0xDC,0x0E,0xF0,0x00,0x00,0x01,0xC0,0x00,
      0x00,0x00,0x01,0xE0,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x3F,0xC0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x07,0xE0,0x00,0x04,0xF8,0xF0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x07,0x60,0x00,0x07,0xE1,0xE0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x0E,0xE0,0x00,0x06,0x18,0x80,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x1D,0xC0,0x00,0x06,0x38,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x1F,0x8F,0x00,0x0C,0x70,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x1B,0x99,0x80,0x0D,0xC6,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x13,0xB0,0xC0,0x05,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x02,0xC0,0xE0,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x01,0x83,0xD8,0x00,0xF6,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x03,0x9E,0xCC,0x00,0xCC,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x0F,0xBC,0xDC,0x00,0xDF,0xF0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x1E,0xBC,0xC8,0x00,0xE0,0x38,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x1C,0xBC,0xC0,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x1F,0x97,0xC0,0x3C,0x01,0x80,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x07,0x83,0x80,0x30,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x03,0x01,0x00,0x03,0xC1,0xC0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x03,0x01,0xC0,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x40,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
      0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

UINT_8 handle;//定义句柄变量，用来识别当前显示器界面

/*调试用粗略时钟参数，在PWM中定义*/
#ifdef __DEBUG__
extern UINT_8 second;
extern UINT_8 minute;
extern UINT_8 hour;
extern UINT_8 day;
#endif

/*消息处理相关变量，在KeyBoard16中定义*/
extern BOOL msgProced;
extern UINT_8 msg;

static void msgProce();
static void PaintScr();

void UiInit()
{
	handle=SCR_SMOKECODE;
	LcdPrintPic(start);
	Delay(1000);
	LcdClear();
}

void UiMain()
{
	#ifdef __DEBUG__
	UINT_8 temp[8];
	#endif

	while(1)
	{
 		SmokeDetector();

		SetWarning();

		SetPWMxC();

		PaintScr();
		
		if(!msgProced)
		{
			msgProce();
			msgProced=TRUE;
		}

		#ifdef __DEBUG__//输出粗略的时间，测试用
		sprintf(temp,"%02d:%02d:%02d",(INT_16)hour,(INT_16)minute,(INT_16)second);//格式输出时间
		LcdPrintStr(temp,3,4);
		#endif
	}
	
}

static void msgProce()
{
	switch(handle)
	{
		case SCR_SMOKECODE: ScrSmokeCode();break;
		case SCR_SETUP: ScrSetup();break;
		default: handle=SCR_SMOKECODE;break;
	}
}

static void PaintScr()
{
	switch(handle)
	{
		case SCR_SMOKECODE: PrintSmokeCode();break;
		case SCR_SETUP: PrintSetup();break;
		default: PrintSmokeCode();break;
	}
}